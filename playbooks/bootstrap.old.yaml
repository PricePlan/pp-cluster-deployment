# Playbook to prepare hosts for ansible
---
- name: prepare new hosts to work with Ansible
  hosts: pp_cluster
  gather_facts: no

  tasks:
  - name: install Python
    raw: dnf install -y {{ item }}
    loop:
      - python3
      - python3-dnf
      - python3-libselinux
      - python3-libsemanage
    tags: python_install

  - name: ensure docker group exists
    group: name=docker state=present
    tags: group_docker

  - name: ensure {{ deploy_user }} user exists
    user:
      name: '{{ deploy_user }}'
      comment: 'An ansible user'
      # group:
      groups:
        - '{{ deploy_group}}'
        - docker
      shell: /bin/bash
      password: '{{ deploy_password | password_hash("sha512") }}'
    tags: deploy_user
