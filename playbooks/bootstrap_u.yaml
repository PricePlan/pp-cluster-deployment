# Playbook to prepare hosts for ansible
---
- name: prepare new hosts to work with Ansible
  hosts: all
  gather_facts: no

  tasks:
  - block:
    - name: install Python
      raw: dnf install -y {{ item }}
      loop:
        - python3
        - python3-dnf
        - python3-libselinux
        - python3-libsemanage
      tags: python_install

    - name: ensure docker group exists
      group: name=docker state=present
      tags: group_docker

    - name: ensure {{ deploy_user }} user exists
      user:
        name: '{{ deploy_user }}'
        comment: 'An Ansible user'
        # group:
        groups:
          - '{{ deploy_group}}'
          - docker
        shell: /bin/bash
        # password: '{{ deploy_password | password_hash("sha512") }}'
      tags: deploy_user

  become: yes
